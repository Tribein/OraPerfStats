<html>
  <head>
	<meta charset="utf-8">
	<style>
	.ns{ letter-spacing: -2px; }
	.sc {  }	
	</style>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
            google.charts.load('current', {'packages': ['corechart']});
            google.charts.load('current', {'packages': ['table']});
            //google.charts.load('current', {'packages':['bar']});
            google.charts.setOnLoadCallback(drawWaitsChart);
            var arrLocksTreeColumns = ['SID', 'Serial', 'Machine', 'Module', 'Program', 'Logon Time', 'SQLID', 'SQL Exec Start Time', 'Event', 'SEQUENCE', 'P1', 'P2', 'Blocking Session'];
            var arrWaitClass = [
                'Timestamp',
                'System I/O',
                'User I/O',
                'Commit',
                'Network',
                'CPU',
                'Administrative',
                'Concurrency',
                'Application',
                'Configuration',
                'Queueing',
                'Scheduler',
                'Other'
            ];
            var arrWaitClassStyle = [
                '',
                'DeepSkyBlue',
                'Blue',
                'Orange',
                'Moccasin',
                'LimeGreen',
                'Silver',
                'DarkRed',
                'Red',
                'Sienna',
                'MistyRose',
                'PaleGreen',
                'Magenta'
            ];
            var arrClassNum = [12, 8, 9, 6, 7, 3, 0, 4, 2, 1, 11, 10];
            arrClassNum[127] = 5;
            var ts;
            var te;
            var timeSpan1;
            var timeSpan2;
            var eventsHeaderData;
            var eventsChart;
            var locksTreeTable;
            var statsTable;
            //--changable
            var spanMinutes = 10;
            var dbUniqueName = 'lmprod_prd';
            var sessionsBlocked = 0;
            var loadimg = "circle.gif";
            //--
            function checkClassNum(inp) {
                for (var i in arrClassNum) {
                    if (arrClassNum[i] === inp) {
                        return i;
                    }
                }
                return -1;
            }
            //--
            //--------------------------------------------------------------
            function unflatten(arr) {
                var tree = [],
                        mappedArr = {},
                        arrElem,
                        mappedElem;

                // First map the nodes of the array to an object -> create a hash table.
                for (var i = 0, len = arr.length; i < len; i++) {
                    arrElem = arr[i];
                    mappedArr[arrElem.id] = arrElem;
                    mappedArr[arrElem.id]['children'] = [];
                }


                for (var id in mappedArr) {
                    if (mappedArr.hasOwnProperty(id)) {
                        mappedElem = mappedArr[id];
                        // If the element is not at the root level, add it to its parent array of children.
                        if (mappedElem.parentid) {
                            try {
                                mappedArr[mappedElem.parentid]['children'].push(mappedElem);
                            } catch (e) {

                            }
                        }
                        // If the element is at the root level, add it to first level elements array.
                        else {
                            tree.push(mappedElem);
                        }
                    }
                }
                return tree;
            }
            //--------------------------------------------------------------
            function preDraw() {
                te = new Date();
                ts = new Date(te.getTime() - 1000 * 60 * spanMinutes);
                timeSpan1 = ts.getFullYear() + '-' +
                        ("0" + (ts.getMonth() + 1)).slice(-2) + '-' + ("0" + ts.getDate()).slice(-2)
                        + ' ' +
                        ("0" + ts.getHours()).slice(-2) + ':' + ("0" + ts.getMinutes()).slice(-2) + ':' + ("0" + ts.getSeconds()).slice(-2)
                        ;
                timeSpan2 = te.getFullYear() + '-' +
                        ("0" + (te.getMonth() + 1)).slice(-2) + '-' + ("0" + te.getDate()).slice(-2)
                        + ' ' +
                        ("0" + te.getHours()).slice(-2) + ':' + ("0" + te.getMinutes()).slice(-2) + ':' + ("0" + te.getSeconds()).slice(-2)
                        ;
            }
            //------WAITS
            function drawWaitsChart() {
                preDraw();				
				var drawRegion = "waitsregion";
                var waitsQuery = "select snapTime,classnum, count(1) val from sessions_buffer where dbuniquename='" +
                        dbUniqueName +
                        "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' group by snapTime,classnum order by snapTime asc";
                //alert(waitsQuery);
                var data = new google.visualization.DataTable();
                //--add Columns
                data.addColumn('string', arrWaitClass[0]);
                for (var i = 1; i < arrWaitClass.length; i++) {
                    data.addColumn('number', arrWaitClass[i]);
                    data.addColumn({type: 'string', role: "style"});
                }
                //-- add Data
                data.addRows(parseWaitsData(getData(waitsQuery)));
                var legendColors = [];
                for (var i = 1; i < arrWaitClass.length; i++) {
                    legendColors[i - 1] = arrWaitClassStyle[i];
                }
                var options = {
                    title: 'Wait Class',
                    width: 1800,
                    height: 500,
                    hAxis: {textPosition: 'none'},
                    vAxis: {minValue: 0, format: '####'},
                    animation: {startup: 'true', duration: 1000},
                    bars: 'vertical',
                    //orientation : 'vertical',
                    bar: {groupWidth: '95%'},
                    legend: {position: 'right', maxLines: 3},
                    colors: legendColors,
                    isStacked: true,
                    backgroundColor: {fill: 'transparent'}
                };
                var waitsChart = new google.visualization.ColumnChart(document.getElementById(drawRegion));
                waitsChart.draw(data, options);
                //--Register Events 
                //--
                function waitsSelectHandler(e) {
                    if (waitsChart.getSelection().length === 0) {
                        if (typeof eventsChart !== 'undefined') {
                            eventsChart.clearChart();
                        }
                    } else {
                        var sel = waitsChart.getSelection();
                        if (typeof arrWaitClass[(Number(sel[0].column) + 1) / 2] !== 'undefined') {
                            drawEventsChart((Number(sel[0].column) + 1) / 2);
                            document.getElementById('eventsregion').scrollIntoView();
                        }
                    }
                }
                google.visualization.events.addListener(waitsChart, 'select', waitsSelectHandler);
                drawSessionsTable();
                drawLocksChart();
                drawSQLsTable();
            }
            //------WAITS
            //------EVENTS
            function drawEventsChart(classNum) {
                classNum = checkClassNum(classNum);
                if (classNum < 0) {
                    return null;
                }
				var drawRegion = "eventsregion";
                var eventsQuery = "select snapTime,event, count(1) val,classnum from sessions_buffer where dbuniquename='" +
                        dbUniqueName +
                        "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' group by snapTime,event,classnum order by snapTime asc, val asc";
                var data = google.visualization.arrayToDataTable(parseEventsData(getData(eventsQuery), Number(classNum)));
                if (data.getNumberOfRows() === 0) {
                    return;
                }                
                var options = {
                    title: 'Events',
                    width: 1800,
                    height: 500,
                    hAxis: {textPosition: 'none'},
                    vAxis: {minValue: 0, format: '####'},
                    animation: {startup: 'true', duration: 1000},
                    bars: 'vertical',
                    //orientation : 'vertical',
                    bar: {groupWidth: '95%'},
                    legend: {position: 'right', maxLines: 3},
                    isStacked: true,
                    backgroundColor: {fill: 'transparent'}
                };
                eventsChart = new google.visualization.ColumnChart(document.getElementById(drawRegion));
                eventsChart.draw(data, options);
                function eventsSelectHandler(e) {
                }
                google.visualization.events.addListener(eventsChart, 'select', eventsSelectHandler);
            }
            //------EVENTS
            //------LOCKSTREE
            function drawLocksTreeTable(input) {
				var drawRegion = "lockstreeregion";
                locksTreeQuery = "select sid,serial,machine,module,program,logon_time,toStringCutToZero(sql_id),sql_exec_start,event,seq,p1,p2,blocking_session from sessions_buffer " +
                        "where dbuniquename='" + dbUniqueName + "' and snapTime='" + input + "' and (" +
                        "blocking_session<>0 or sid in (select blocking_session from sessions_buffer where dbuniquename='" + dbUniqueName + "' and snapTime='" + input + "') )";
                var data = google.visualization.arrayToDataTable(parseLocksTreeData(getData(locksTreeQuery)));
                var options = {
                    title: 'LocksTree',
                    width: '100%',
                    //height: '100%',
                    allowHtml: true,
                    showRowNumber: true,
                    backgroundColor: {fill: 'transparent'},
                    cssClassNames: { tableCell: 'sc' }
                };
                var locksTreeTable = new google.visualization.Table(document.getElementById(drawRegion));
                locksTreeTable.draw(data, options);

                function locksTreeSelectHandler(e) {
                    if (locksTreeTable.getSelection().length === 0) {
                        if (typeof statsTable !== 'undefined') {
                            statsTable.clearChart();
                        }
                    } else {
                        var sel = locksTreeTable.getSelection();
                        document.getElementById('sqltextregion').innerHTML = '<span style="font-family: monospace; font-size: large;"><b>'+
							data.getValue(sel[0].row, 6)+
							'</b>:<br />'+
							getSQLText(data.getValue(sel[0].row, 6)).replace(/\\n/g,'<br />')+
							'</span>';
                        drawStatsTable(data.getValue(sel[0].row, 0).match(/[0-9]+/)[0],data.getValue(sel[0].row, 1));
                        document.getElementById('statsregion').scrollIntoView();
                    }
                }
                google.visualization.events.addListener(locksTreeTable, 'select', locksTreeSelectHandler);
            }
            //------LOCKSTREE            
            //------BLOCKINGS
            function drawLocksChart() {
				var drawRegion = "locksregion";
                var locksQuery = "select snapTime, sum(if(blocking_session=0,0,1)) as val from sessions_buffer where dbuniquename='" +
                        dbUniqueName +
                        "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' group by snapTime order by snapTime asc";
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Timestamp');
                data.addColumn('number', 'Sessons blocked');
                data.addRows(parseLocksData(getData(locksQuery)));
                var options = {
                    title: 'Blocking Sessions',
                    width: 1800,
                    height: 500,
                    hAxis: {textPosition: 'none'},
                    vAxis: {minValue: 0, format: '####'},
                    animation: {startup: 'true', duration: 1000},
                    bars: 'vertical',
                    //orientation : 'vertical',
                    bar: {groupWidth: '95%'},
                    legend: {position: 'right'},
                    isStacked: true,
                    backgroundColor: {fill: 'transparent'}
                };
                if (sessionsBlocked === 0) {
                    return;
                }
                var locksChart = new google.visualization.ColumnChart(document.getElementById(drawRegion));
                locksChart.draw(data, options);
                function locksSelectHandler(e) {
                    if (locksChart.getSelection().length === 0) {
                        if (typeof locksTreeTable !== 'undefined') {
                            locksTreeTable.clearChart();
                        }
                    } else {
                        var sel = locksChart.getSelection();
                        drawLocksTreeTable(data.getValue(sel[0].row, 0));
                        document.getElementById('lockstreeregion').scrollIntoView();
                    }
                }
                google.visualization.events.addListener(locksChart, 'select', locksSelectHandler);
            }
            //------BLOCKINGS
            //------SESSIONS 
            function drawSessionsTable() {
				var drawRegion = "sessionsregion";
                var sessionsQuery = "select " +
                        "sid,classnum,cnt,tot,ni,module,machine,schemaname,serial,sipHash64(concat(module,machine,schemaname,toString(serial),toString(sid))) as sessid" +
                        " from (select sid,serial,classnum,cnt,tot,machine,module,schemaname from (" +
                        "select sid,serial,module,machine,schemaname,classnum,count(1) as cnt,1 as dummy " +
                        "from sessions_buffer where classnum<>6 and dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' " +
                        "group by sid,serial,module,machine,schemaname,classnum" +
                        ") all left join (" +
                        "select 1 as dummy,count(st) as tot from (select snapTime as st " +
                        "from sessions_buffer where dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' " +
                        "group by st)" +
                        ") using dummy) all inner join (" +
                        "select sid,serial,module,machine,schemaname,ni from (" +
                        "select sid,serial,module,machine,schemaname,count(1) as ni " +
                        "from sessions_buffer where dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' and classnum<>6 " +
                        "group by sid,serial,module,machine,schemaname having count(1)>0 order by ni desc" +
                        ") limit 10" +
                        ") using sid,serial,module,machine,schemaname " +
                        "order by ni desc,sid asc,cnt asc";
                //document.getElementById("query").innerHTML=sessionsQuery;
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'SID,SERIAL');
                data.addColumn('string', 'SCHEMA');
                data.addColumn('string', 'MODULE@MACHINE');
                data.addColumn('string', 'WAITS');
                data.addRows(parseSessionsData(getData(sessionsQuery)));
                var options = {
                    title: 'Sessions',
                    width: '38%',
                    //height: '100%',
                    allowHtml: true,
                    showRowNumber: false,
                    backgroundColor: {fill: 'transparent'},
                    cssClassNames: { tableCell: 'sc' }
                };
                var sessionsTable = new google.visualization.Table(document.getElementById(drawRegion));
                sessionsTable.draw(data, options);

                function sessionsSelectHandler(e) {
                    if (sessionsTable.getSelection().length === 0) {
                        if (typeof statsTable !== 'undefined') {
                            statsTable.clearChart();
                        }
                    } else {
                        var sel = sessionsTable.getSelection();
                        drawStatsTable(data.getValue(sel[0].row, 0).split(',')[0],data.getValue(sel[0].row, 0).split(',')[1]);
                        document.getElementById('statsregion').scrollIntoView();
                    }
                }
                google.visualization.events.addListener(sessionsTable, 'select', sessionsSelectHandler);
            }
            //------SESSIONS  
            //------SQL 
            function drawSQLsTable() {
				var drawRegion = "sqlsregion";
                var sqlsQuery = "select sqlid,sql_id,classnum,cnt,tot,ni from (select sqlid,sql_id,classnum,cnt,tot from (" +
                        "select sipHash64(toStringCutToZero(sql_id)) as sqlid, sql_id,classnum,count(1) as cnt, 1 as dummy " +
                        "from sessions_buffer where dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' and toStringCutToZero(sql_id)<>'-' and classnum<>6 " +
                        "group by sqlid,sql_id,classnum" +
                        ") all left join (" +
                        "select 1 as dummy,count(st) as tot from (" +
						"select snapTime as st from sessions_buffer " +
                        "where toStringCutToZero(sql_id)<>'-' and dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' " +
                        "group by snapTime)" +
                        ") using dummy) all inner join (" +
                        "select sql_id,ni from (" +
                        "select sql_id,count(1) as ni from sessions_buffer " +
                        "where classnum<>6 and toStringCutToZero(sql_id)<>'-' and dbuniquename='" + dbUniqueName + "' and snapTime >= '" + timeSpan1 + "' and snapTime <= '" + timeSpan2 + "' " +
                        "group by sql_id having count(1)>0 order by ni desc" +
                        ") limit 10" +
                        ") using sql_id order by ni desc,sql_id,cnt asc";
                //alert(sqlsQuery);
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'SQL ID');
                data.addColumn('string', 'WAITS');
                data.addRows(parseSQLsData(getData(sqlsQuery)));
                var options = {
                    title: 'SQL',
                    width: '58%',
                    //height: '100%',
                    allowHtml: true,
                    showRowNumber: false,
                    backgroundColor: {fill: 'transparent'},
                    cssClassNames: { tableCell: 'sc' }
                };
                var sqlsTable = new google.visualization.Table(document.getElementById(drawRegion));
                sqlsTable.draw(data, options);
                function sqlidSelectHandler(e) {
                    if (sqlsTable.getSelection().length === 0) {
                        if (typeof sqlsTable !== 'undefined') {
                            document.getElementById('sqltextregion').innerHTML='';
                        }
                    } else {
                        var sel = sqlsTable.getSelection();
                        document.getElementById('sqltextregion').innerHTML = '<span style="font-family: monospace; font-size: large;"><b>'+
							data.getValue(sel[0].row, 0)+
							'</b>:<br />'+
							getSQLText(data.getValue(sel[0].row, 0)).replace(/\\n/g,'<br />').replace(/\\\'/g,"'")+
							'</span>';
                        document.getElementById('sqltextregion').scrollIntoView();
                    }
                }
                google.visualization.events.addListener(sqlsTable, 'select', sqlidSelectHandler);                
            }
            //------SQL
            //--STATS            
            function drawStatsTable(inputsid,inputserial) {
                if (typeof inputsid === 'undefined') {
                    return null;
                }
				var drawRegion = "statsregion";
                var statsQuery = "select statName,vl from ("+
							"select dbuniquename,statId,endvalue-beginvalue as vl from (" +
							"select dbuniquename,statId,value as beginvalue from sesstats_buffer where dbuniquename='" + dbUniqueName + "' and snapTime = (" +
							"select min(snapTime) from sesstats_buffer where dbuniquename='" + dbUniqueName + "' and sid=" + inputsid + " and serial="+inputserial+" and snapTime>='" + timeSpan1 + "' and snapTime<='" + timeSpan2 + "'" +
							") and sid=" + inputsid + " and serial="+inputserial+
							") any inner join (" +
							"select dbuniquename,statId,value as endvalue from sesstats_buffer where dbuniquename='" + dbUniqueName + "' and snapTime = (" +
							"select max(snapTime) from sesstats_buffer where dbuniquename='" + dbUniqueName + "' and sid=" + inputsid + " and serial="+inputserial+" and snapTime>='" + timeSpan1 + "' and snapTime<='" + timeSpan2 + "'" +
							") and sid=" + inputsid + " and serial="+inputserial+
							") using statId,dbuniquename where (endvalue-beginvalue)<>0 ) "+
							" any left join statnames_buffer using statId,dbuniquename " +
							"order by vl desc";
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Statistic for SID ' + inputsid);
                data.addColumn('number', 'Value diff');
                data.addRows(parseStatsData(getData(statsQuery)));
                var options = {
                    width: '100%',
                    //height: '100%',
                    allowHtml: true,
                    showRowNumber: false,
                    backgroundColor: { fill: 'transparent' },
					cssClassNames: { tableCell: 'sc' }                    
                };
                statsTable = new google.visualization.Table(document.getElementById(drawRegion));
                statsTable.draw(data, options);
            }
            //--STATS
            //--SQLTEXT
            function getSQLText(sqlid){
				if(sqlid.length == 13){
					var sqlTextQuery = "select distinct sqltext from sqltexts_buffer where sqlid='"+sqlid+"'";
					var	sqltext = getData(sqlTextQuery);
					return sqltext;
				}else{
					return "Wrong SQLID"
				}
			}
            //--SQLTEXT
            //--
            function getData(query) {
                var xmlHttp = new XMLHttpRequest();
                var xmlHttpOutput;
                xmlHttp.open("POST", 'http://ogw.moscow.sportmaster.ru:18123/ckh/?database=oradb&user=oracle&password=elcaro&query=', false); // false for synchronous request
                xmlHttp.send(query);
                return xmlHttp.responseText;
            }
            //--
            function parseEventsData(inputData, classNum) {
                //--
                function searchHeader(inp) {
                    for (var hi in eventsHeaderData) {
                        if (eventsHeaderData[hi] === inp) {
                            return hi;
                        }
                    }
                    return -1;
                }
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                eventsHeaderData = ['Timestamp'];
                var idx;
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        if (searchHeader(rowData[1]) === -1 && Number(rowData[3]) === classNum) {
                            eventsHeaderData[eventsHeaderData.length] = rowData[1];
                        }
                    }
                }
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[0].replace(/[:-\s]/g, ""));
                        if (typeof tmpData[idx] === 'undefined') {
                            tmpData[idx] = [];
                            tmpData[idx][0] = String(rowData[0]);
                            for (var ti = 1; ti < eventsHeaderData.length; ti++) {
                                tmpData[idx][ti] = 0;
                            }
                        }
                        if (Number(rowData[3]) === classNum) {
                            tmpData[idx][searchHeader(rowData[1])] = Number(rowData[2]);
                        }
                    }
                }
                outData.push(eventsHeaderData);
                for (var ei in tmpData) {
                    outData.push(tmpData[ei]);
                }
                return outData;
            }
            //--
            function parseWaitsData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                var idx;
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[0].replace(/[:-\s]/g, ""));
                        if (typeof tmpData[idx] === 'undefined') {
                            tmpData[idx] = [rowData[0], 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, ""];
                        }
                        if (Number(rowData[1]) !== 6) {
                            tmpData[idx][arrClassNum[Number(rowData[1])] * 2 - 1] = Number(rowData[2]);
                            tmpData[idx][arrClassNum[Number(rowData[1])] * 2] = arrWaitClassStyle[arrClassNum[Number(rowData[1])]];
                        }
                    }
                }
                for (var wi in tmpData) {
                    outData.push(tmpData[wi]);
                }
                return outData;
            }
            //--
            //--
            function parseStatsData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var rowData = [];
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        outData.push([rowData[0], Number(rowData[1])]);
                    }
                }
                return outData;
            }
            //--            
            function parseLocksData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                var idx;
                sessionsBlocked = 0;
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[0].replace(/[:-\s]/g, ""));
                        tmpData[idx] = [rowData[0], Number(rowData[1])];
                        if (sessionsBlocked === 0 && Number(rowData[1]) !== 0) {
                            sessionsBlocked = 1;
                        }
                    }
                }
                for (var li in tmpData) {
                    outData.push(tmpData[li]);
                }
                return outData;
            }
            //--
            function colorPercentWait(current, total, classnum, nonidle) {
                var out = '<font class="ns" title="' + arrWaitClass[arrClassNum[classnum]] + " " + (Math.round(100 * current / total)) + '%" color="' + arrWaitClassStyle[arrClassNum[classnum]] + '">';
                var maxchars = 100;// * Math.ceil(nonidle / total);
                for (var i = 0; i < Math.ceil(maxchars * current / total); i++) {
                    out += "|";
                }
                out += '</font>';
                return out;
            }
            //--
            function parseSessionsData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                var tmpIdx = [];
                var k = 0;
                var idx;
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[9]);
                        if (typeof tmpIdx[idx] === 'undefined') {
                            tmpIdx[idx] = k;
                            tmpData[k] = [rowData[0] + "," + rowData[8], rowData[7], rowData[5] + "@" + rowData[6], colorPercentWait(rowData[2], rowData[3], rowData[1], rowData[4])];
                            k++;
                        } else {
                            tmpData[tmpIdx[idx]][3] = tmpData[tmpIdx[idx]][3] + colorPercentWait(rowData[2], rowData[3], rowData[1], rowData[4]);
                        }
                    }
                }
                for (var si in tmpData) {
                    outData.push(tmpData[si]);
                }
                return outData;
            }
            //--
            //--
            function parseSQLsData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                var tmpIdx = [];
                var k = 0;
                var idx;
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[0]);
                        if (typeof tmpIdx[idx] === 'undefined') {
                            tmpIdx[idx] = k;
                            tmpData[k] = [rowData[1], colorPercentWait(rowData[3], rowData[4], rowData[2], rowData[5])];
                            k++;
                        } else {
                            tmpData[tmpIdx[idx]][1] = tmpData[tmpIdx[idx]][1] + colorPercentWait(rowData[3], rowData[4], rowData[2], rowData[5]);
                        }
                    }
                }
                for (var si in tmpData) {
                    outData.push(tmpData[si]);
                }
                return outData;
            }
            //--
            function parseLocksTreeData(inputData) {
                var dataLines = inputData.split(/[\n]+/);
                var outData = [];
                var tmpData = [];
                var rowData = [];
                var idx;
                var arrTree = [];
                var arrSIDSorted = [];
                var arrSIDLevel = [];
                for (var i = 0; i < dataLines.length; i++) {
                    if (dataLines[i].length > 0) {
                        rowData = dataLines[i].split(/[\t]+/);
                        idx = Number(rowData[0]);
                        tmpData[idx] = [];
                        for (var j = 0; j < arrLocksTreeColumns.length; j++) {
                            tmpData[idx][j] = rowData[j];
                        }
                        arrTree.push({"id": Number(rowData[0]), "parentid": Number(rowData[12])});
                    }
                }
                //--
                arrTree = unflatten(arrTree);
                function recGetSID(input, level) {
                    arrSIDSorted.push(Number(input.id));
                    arrSIDLevel.push(level);
                    if (input.children.length > 0) {
                        level++;
                        for (var s in input.children) {
                            recGetSID(input.children[s], level);
                        }
                    }
                }
                //--
                for (var i in arrTree) {
                    recGetSID(arrTree[i], 0);
                }
                //--
                outData.push(arrLocksTreeColumns);
                /*
                 for (var lti in tmpData) {
                 outData.push(tmpData[lti]);
                 }
                 */
                for (var i = 0; i < arrSIDSorted.length; i++) {
                    if (arrSIDLevel[i] === 0) {
                        tmpData[arrSIDSorted[i]][0] = '<strong>' + tmpData[arrSIDSorted[i]][0] + '</strong>';
                        ;
                    }
                    for (var j = 0; j < arrSIDLevel[i]; j++) {
                        tmpData[arrSIDSorted[i]][0] = '&nbsp;&nbsp;&nbsp;&nbsp;' + tmpData[arrSIDSorted[i]][0];
                    }
                    outData.push(tmpData[arrSIDSorted[i]]);
                }
                return outData;
            }
            //--
 
    </script>
  </head>

  <body onLoad=''>
    <div id="waitsregion"></div>
    <div id="eventsregion"></div>
    <div id="eventsregion"></div>
    <div id="locksregion"></div>
    <div id="lockstreeregion"></div>
    <div id="sqltextregion"></div>
    <div>
		<span id="sqlsregion"></span>
		&nbsp;
		<span id="sessionsregion"></span>
	</div>
	<div id="statsregion"></div>
  </body>
</html>
